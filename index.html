<!-- <!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guida Turistica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
      .audio-btn {
        background: #000;
        color: #fff;
        border: none;
        border-radius: 2rem;
        padding: 0.5rem 2rem;
        font-weight: 500;
        margin-bottom: 1rem;
        transition: background 0.2s, color 0.2s;
      }
      .audio-btn:hover, .audio-btn:focus {
        background: #222 !important;
        color: #fff !important;
        outline: none !important;
      }
    </style>
</head>
<body>
    <div class="container py-5" id="main-content">
        <div class="d-flex justify-content-center align-items-center" style="height: 100vh;" id="loader">
  <div class="spinner-border text-dark" role="status" style="width: 4rem; height: 4rem;">
    <span class="visually-hidden">Caricamento...</span>
  </div>
</div>

    </div>
    <script>
  // URL del tuo Apps Script pubblicato come Web App
  const DATI_SITI = 'https://script.google.com/macros/s/AKfycbz_vCmqTW28sEUDcEj-kg48TBAKpDt_cgmfxRyKDy8P31f1-AD2JfxX__bniSnCBz0P/exec';
  const DATI_SIMULAZIONI = 'https://script.google.com/macros/s/AKfycbx3vz33LsWKl9OuhFbtIQbzAm3dPdU8aZPGoWeUFjioT93oJDNZUtowCf_XAMOhofnd/exec';
 const DATI_MUSEI = 'https://script.google.com/macros/s/AKfycbytsQmB3X8E6HkvmI7ZlBbbbOMiiRwm_PxznEUXv5f5ZVonAHLmPdje1B-2MHf857aa/exec';
  let datiSiti = [];
  let datiMusei = [];
  let datiSimulazioni = [];

  // Karaoke highlighting variables
  let currentWordIndex = 0;
  let words = [];
  let highlightInterval;
  let synth = window.speechSynthesis;
  let utterance;
  let selectedVoice = null;

  // Stato della vista: 'home', 'siti', 'musei', 'simulazioni'
  let currentView = 'home';

  // Carica i dati dei siti da Apps Script
  fetch(DATI_SITI)
    .then(r => r.json())
    .then(data => {
      // Adatta i dati al formato atteso dal frontend
      datiSiti = data.map(row => ({
        regione: row['Regione'],
        nome: row['Nome sito'],
        descrizione: row['Descrizione']
      }));
      mostraHome();
    })
    .catch(() => {
      document.getElementById('main-content').innerHTML = '<div class="alert alert-danger">Errore nel caricamento dei dati dal foglio Google.</div>';
    });

    fetch(DATI_MUSEI)
  .then(r => r.json())
  .then(data => {
    datiMusei = data.map(row => ({
      regione: row['Regione'],
      nome: row['Nome sito'],
      descrizione: row['Descrizione']
    }));
  });

fetch(DATI_SIMULAZIONI)
  .then(r => r.json())
  .then(data => {
    console.log(data); // üîç mostra cosa ricevi dal foglio
    datiSimulazioni = data.map(row => ({
      regione: row['Regione'],
      nome: row['Nome sito'],
      descrizione: row['Descrizione'],
      descrizione_fr: row['Descrizione_fr']
    }));
  });

  // Voce italiana per audio
  function setVoice() {
    const voices = synth.getVoices();
    selectedVoice = voices.find(v => v.lang.startsWith('it') && v.name.toLowerCase().includes('google'));
    if (!selectedVoice) {
      selectedVoice = voices.find(v => v.lang.startsWith('it'));
    }
  }
  if (typeof speechSynthesis !== "undefined") {
    speechSynthesis.onvoiceschanged = setVoice;
    setVoice();
  }

  function wrapWordsInSpans(text) {
    return text.split(/(\s+)/).map((word, index) => {
      if (word.trim()) {
        return `<span class="word" data-index="${Math.floor(index/2)}">${word}</span>`;
      }
      return word;
    }).join('');
  }

  function highlightReadText(currentIndex) {
    document.querySelectorAll('.word').forEach((word, index) => {
      const wordIndex = parseInt(word.dataset.index);
      if (wordIndex < currentIndex) {
        word.classList.remove('current');
        word.classList.add('read');
      } else if (wordIndex === currentIndex) {
        word.classList.remove('read');
        word.classList.add('current');
        word.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
      } else {
        word.classList.remove('read', 'current');
      }
    });
  }

  function startHighlighting() {
    const wordsPerMinute = 150;
    const millisecondsPerWord = (60 / wordsPerMinute) * 1000;
    highlightInterval = setInterval(() => {
      if (currentWordIndex < words.length) {
        highlightReadText(currentWordIndex);
        currentWordIndex++;
      } else {
        stopHighlighting();
      }
    }, millisecondsPerWord);
  }

  function stopHighlighting() {
    if (highlightInterval) {
      clearInterval(highlightInterval);
      highlightInterval = null;
    }
    document.querySelectorAll('.word').forEach(word => {
      word.classList.remove('read', 'current');
    });
    currentWordIndex = 0;
  }

  // Stop audio su qualsiasi click, tranne Play/Stop
  document.addEventListener('click', function(e) {
    if (
      e.target.id === 'playBtn' ||
      e.target.id === 'stopBtn'
    ) return;
    stopAudio();
  }, true);

  // Play sempre funzionante e sempre riparte dall'inizio
  function playAudio(textOverride) {
    stopAudio();
    let text = "";
    if (typeof textOverride === "string" && textOverride.trim().length > 0) {
      text = textOverride.trim();
      words = text.split(/\s+/);
    } else if (words && words.length > 0) {
      text = words.join(' ');
    } else {
      let descr = document.getElementById('descrizione') || document.getElementById('descrizioneMuseo');
      if (descr) {
        text = descr.innerText || descr.textContent || "";
        words = text.trim().split(/\s+/);
      }
      if (!text.trim()) return;
    }
    utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "it-IT";
    if(selectedVoice) utterance.voice = selectedVoice;
    utterance.rate = 0.98; // pi√π naturale e meno veloce
    utterance.pitch = 1;   // tono naturale
    utterance.volume = 1;
    currentWordIndex = 0;
    startHighlighting();
    utterance.onend = function() { stopHighlighting(); };
    utterance.onerror = function() { stopHighlighting(); };
    synth.speak(utterance);
  }
  function stopAudio() {
    if(synth.speaking) synth.cancel();
    stopHighlighting();
  }

  document.addEventListener('click', function(e) {
    if (
      e.target.id === 'playBtn' ||
      e.target.id === 'stopBtn'
    ) return;
    stopAudio();
  });

  // Home con un solo pulsante nero per ogni sezione
  function mostraHome() {
    currentView = 'home';
    document.getElementById('main-content').innerHTML = `
      <h1 class="mb-4 text-center">Guida Turistica</h1>
      <div class="d-flex flex-column align-items-center" style="max-width: 400px; margin: 0 auto;">
        <button class="audio-btn main-link w-100 mb-3" data-type="siti">Siti</button>
        <div class="w-100 d-flex align-items-center justify-content-center my-2">
          <hr class="flex-grow-1" style="border-top: 2px solid #bbb; margin: 0 1rem;">
        </div>
        <button class="audio-btn main-link w-100 mb-3" data-type="musei">Musei</button>
        <div class="w-100 d-flex align-items-center justify-content-center my-2">
          <hr class="flex-grow-1" style="border-top: 2px solid #bbb; margin: 0 1rem;">
        </div>
        <button class="audio-btn main-link w-100" data-type="simulazioni">Simulazioni</button>
      </div>
    `;
    document.querySelectorAll('.main-link').forEach(el => {
      el.addEventListener('click', function() {
        if (el.dataset.type === 'siti') mostraRegioni('siti');
        if (el.dataset.type === 'musei') mostraRegioni('musei');
        if (el.dataset.type === 'simulazioni') mostraRegioni('simulazioni');
      });
    });
  }

  // Mostra le regioni per la categoria scelta
  function mostraRegioni(tipo) {
    currentView = tipo;
    let dati, titolo;
    if (tipo === 'siti') {
      dati = datiSiti;
      titolo = 'Siti';
    } else if (tipo === 'musei') {
      dati = datiMusei;
      titolo = 'Musei';
    } else {
      dati = datiSimulazioni;
      titolo = 'Simulazioni';
    }
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backHome" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna alla home
      </button>
      <h2 class="mb-3">${titolo} per regione</h2>
      <ul class="list-group" id="regioni-list">
        ${[...new Set(dati.map(s => s.regione))].sort((a, b) => a.localeCompare(b, 'it')).map(regione =>
          `<li class="list-group-item region-link" data-region="${regione}">${regione}</li>`
        ).join('')}
      </ul>
    `;
    document.getElementById('backHome').onclick = mostraHome;
    document.querySelectorAll('.region-link').forEach(el => {
      el.addEventListener('click', function() {
        if (tipo === 'siti') mostraSiti(el.dataset.region);
        if (tipo === 'musei') mostraMusei(el.dataset.region);
        if (tipo === 'simulazioni') mostraSimulazioni(el.dataset.region);
      });
    });
  }

  // Mostra i siti di una regione
  function mostraSiti(region) {
    const siti = datiSiti.filter(s => s.regione === region);
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backRegioni" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna alle regioni
      </button>
      <h2 class="mb-3">${region}</h2>
      <ul class="list-group mb-3">
        ${siti.map((sito, idx) => `<li class="list-group-item site-link" data-site="${idx}">${sito.nome}</li>`).join('')}
      </ul>
    `;
    document.getElementById('backRegioni').onclick = () => mostraRegioni('siti');
    document.querySelectorAll('.site-link').forEach((el, idx) => {
      el.addEventListener('click', function() {
        mostraDettaglioSito(region, idx);
      });
    });
  }

  // Mostra i musei di una regione
  function mostraMusei(region) {
    const musei = datiMusei.filter(s => s.regione === region);
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backRegioni" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna alle regioni
      </button>
      <h2 class="mb-3">${region}</h2>
      <ul class="list-group mb-3">
        ${musei.map((museo, idx) => `<li class="list-group-item museo-link" data-museo="${idx}">${museo.nome}</li>`).join('')}
      </ul>
    `;
    window.scrollTo({ top: 0, behavior: 'smooth' });

    document.getElementById('backRegioni').onclick = () => mostraRegioni('musei');
    document.querySelectorAll('.museo-link').forEach((el, idx) => {
      el.addEventListener('click', function() {
        mostraDettaglioMuseo(region, idx);
      });
    });
  }

  // Mostra le simulazioni di una regione
  function mostraSimulazioni(region) {
    const simulazioni = datiSimulazioni.filter(s => s.regione === region);
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backRegioni" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna alle regioni
      </button>
      <h2 class="mb-3">${region}</h2>
      <ul class="list-group mb-3">
        ${simulazioni.map((sim, idx) => `<li class="list-group-item simulazione-link" data-simulazione="${idx}">${sim.nome}</li>`).join('')}
      </ul>
    `;
    document.getElementById('backRegioni').onclick = () => mostraRegioni('simulazioni');
    document.querySelectorAll('.simulazione-link').forEach((el, idx) => {
      el.addEventListener('click', function() {
        mostraDettaglioSimulazione(region, idx);
      });
    });
  }

  // Dettaglio sito con audio
  function mostraDettaglioSito(region, idx) {
    const sitiRegione = datiSiti.filter(s => s.regione === region);
    const sito = sitiRegione[idx];
    // FIX: Rimuovi eventuali caratteri speciali che possono bloccare TTS
    const descrizioneTesto = (sito.descrizione || "").replace(/\r?\n/g, " ").replace(/\s+/g, " ").trim();
    const wrappedText = wrapWordsInSpans(sito.descrizione || "");
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backSiti" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna ai siti
      </button>
      <h2 class="mb-3">${sito.nome}</h2>
      <button class="audio-btn me-2" id="playBtn">Play</button>
      <button class="audio-btn" id="stopBtn">Stop</button>
      <div id="descrizione">${wrappedText}</div>
    `;
    words = descrizioneTesto.length > 0 ? descrizioneTesto.split(/\s+/) : [];
    document.getElementById('playBtn').addEventListener('click', function(e){
      e.stopPropagation();
      playAudio(descrizioneTesto);
    });
    document.getElementById('stopBtn').addEventListener('click', function(e){
      e.stopPropagation();
      stopAudio();
    });
    document.getElementById('backSiti').onclick = () => mostraSiti(region);
  }

  // Dettaglio museo con audio
  function mostraDettaglioMuseo(region, idx) {
    const museiRegione = datiMusei.filter(s => s.regione === region);
    const museo = museiRegione[idx];
    const wrappedText = wrapWordsInSpans(museo.descrizione || "");
    document.getElementById('main-content').innerHTML = `
      <button class="modern-back mb-3" id="backMusei" type="button">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Torna ai musei
      </button>
      <h2 class="mb-3">${museo.nome}</h2>
      <button class="audio-btn me-2" id="playBtn">Play</button>
      <button class="audio-btn" id="stopBtn">Stop</button>
      <div id="descrizioneMuseo">${wrappedText}</div>
    `;
    words = Array.from(document.querySelectorAll('.word')).map(span => span.textContent.trim());
    document.getElementById('playBtn').addEventListener('click', function(e){
      e.stopPropagation();
      playAudio();
    });
    document.getElementById('stopBtn').addEventListener('click', function(e){
      e.stopPropagation();
      stopAudio();
    });
    document.getElementById('backMusei').onclick = () => mostraMusei(region);
  }

  // Dettaglio simulazione con audio e switch lingua senza auto-play
  function mostraDettaglioSimulazione(region, idx) {
    const simulazioniRegione = datiSimulazioni.filter(s => s.regione === region);
    const simulazione = simulazioniRegione[idx];
    let lingua = 'it'; // default italiano

    function renderSimulazione(lang) {
      const testo = lang === 'fr' ? (simulazione.descrizione_fr || "") : (simulazione.descrizione || "");
      const wrappedText = wrapWordsInSpans(testo);
      document.getElementById('main-content').innerHTML = `
        <button class="modern-back mb-3" id="backSimulazioni" type="button">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          Torna alle simulazioni
        </button>
        <h2 class="mb-3">${simulazione.nome}</h2>
        <div class="mb-3">
          <span id="flag-it" style="cursor:pointer;font-size:1.7em;" title="Italiano">üáÆüáπ</span>
          <span id="flag-fr" style="cursor:pointer;font-size:1.7em;margin-left:0.5em;" title="Francese">üá´üá∑</span>
        </div>
        <button class="audio-btn me-2" id="playBtn">Play</button>
        <button class="audio-btn" id="stopBtn">Stop</button>
        <div id="descrizioneSimulazione">${wrappedText}</div>
      `;
      words = Array.from(document.querySelectorAll('.word')).map(span => span.textContent.trim());
      document.getElementById('playBtn').addEventListener('click', function(e){
        e.stopPropagation();
        playAudioSimulazione(lang);
      });
      document.getElementById('stopBtn').addEventListener('click', function(e){
        e.stopPropagation();
        stopAudio();
      });
      document.getElementById('backSimulazioni').onclick = () => mostraSimulazioni(region);
      document.getElementById('flag-it').onclick = () => {
        lingua = 'it';
        renderSimulazione('it');
      };
      document.getElementById('flag-fr').onclick = () => {
        lingua = 'fr';
        renderSimulazione('fr');
      };
    }

    function playAudioSimulazione(lang) {
      stopAudio();
      const text = lang === 'fr'
        ? (simulazione.descrizione_fr || "")
        : (simulazione.descrizione || "");
      words = text.split(/\s+/);
      utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang === 'fr' ? "fr-FR" : "it-IT";
      const voices = synth.getVoices();
      let voice = voices.find(v => v.lang.startsWith(lang === 'fr' ? 'fr' : 'it') && v.name.toLowerCase().includes('google'));
      if (!voice) voice = voices.find(v => v.lang.startsWith(lang === 'fr' ? 'fr' : 'it'));
      if (voice) utterance.voice = voice;
      utterance.rate = 0.98; // pi√π naturale e meno veloce
      utterance.pitch = 1;
      utterance.volume = 1;
      currentWordIndex = 0;
      startHighlighting();
      utterance.onend = function() { stopHighlighting(); };
      utterance.onerror = function() { stopHighlighting(); };
      synth.speak(utterance);
    }

    renderSimulazione('it');
  }
    </script>
</body>
</html> -->



<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test di Inglese B2</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px 0; background: #f8f9fa; }
        .question-card { margin-bottom: 30px; background: white; }
        .option { cursor: pointer; transition: all 0.3s; padding: 15px; border-radius: 8px; margin: 8px 0; border: 2px solid #dee2e6; }
        .option:hover:not(.disabled) { background: #f8f9fa; transform: translateX(5px); }
        .correct { background: #d4edda !important; border-color: #28a745 !important; }
        .incorrect { background: #f8d7da !important; border-color: #dc3545 !important; }
        .disabled { pointer-events: none; opacity: 0.7; }
        .explanation { margin-top: 15px; padding: 15px; background: #e7f3ff; border-left: 4px solid #0d6efd; display: none; }
        .badge-level { font-size: 0.9rem; }
        .reading-passage { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; line-height: 1.8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-4">Test di Inglese B2</h1>
            <p class="lead">Preparazione al concorso - quesiti</p>
            <span class="badge bg-primary badge-level">Livello B2 - Upper Intermediate</span>
        </div>

        <div id="questions-container"></div>

        <div class="text-center mt-4">
            <button class="btn btn-primary btn-lg" onclick="location.reload()">
                <i class="bi bi-arrow-clockwise"></i> Ricarica Test
            </button>
        </div>
    </div>

    <script>
        const questions = [
            {
                type: "phrasal",
                text: "When planning a new event, it is always essential to work ________ the total costs in advance.",
                options: ["away", "under", "in", "out"],
                correct: 3,
                explanation: "Il phrasal verb 'work out' significa 'calcolare' o 'determinare'. √à comune nel contesto di costi e calcoli finanziari. Altri phrasal verbs come 'work away' (lavorare continuamente) o 'work under' (lavorare sotto qualcuno) non hanno senso in questo contesto."
            },
            {
                type: "reading",
                passage: "Despite the chaos of lockdown, by the end of 2020 overall sales of print books in the UK were up 5% year-on-year, according to industry watchers Nielsen BookScan. More particularly, fiction did extremely well ‚Äì adult fiction increased 8% in volume terms, with 147 million books sold. So too did children's books, up 7%, to 109 million books. Overall, the British public spent ¬£1.8 billion on 202 million print books. Digital sales soared, ebooks growing 16% and audiobook sales 21% year on year.",
                text: "'Soared' in this context means:",
                options: ["stayed the same", "went up quickly", "decreased slightly", "dropped steadily"],
                correct: 1,
                explanation: "'Soared' significa 'salire rapidamente' o 'schizzare in alto'. Nel contesto delle vendite digitali che crescono del 16-21%, indica un aumento rapido e significativo. √à un verbo forte usato per enfatizzare una crescita importante."
            },
            {
                type: "reading",
                passage: "The long wait is over for students and academics, who return to face-to-face teaching this term, in a place that truly has the benefits of meeting in the real world. The new Marshall Building, which looks out over Lincoln's Inn Fields like a shiny white palazzo, houses some of the finest spaces that any London university has to offer. The project is the latest addition to the London School of Economics' (LSE) impressive stable of recent commissions, which comprise the Centre Building's steel-framed blocks.",
                text: "The Marshall Building is:",
                options: ["London University's new headquarters", "LSE's latest architectural project", "home to LSE's Department of Law", "going to replace the Centre Building"],
                correct: 1,
                explanation: "Il testo afferma chiaramente che 'the project is the latest addition to the London School of Economics' (LSE) impressive stable of recent commissions', quindi √® l'ultimo progetto architettonico della LSE. Non √® il quartier generale, n√© specificamente per legge, n√© sostituisce il Centre Building."
            },
            {
                type: "reading",
                passage: "Parents or teachers of teenagers may find it hard to believe that sarcasm is a sign of a flexible and inventive mind. Yet, that is exactly what psychologists and neuroscientists have been arguing. They have found that sarcasm requires the brain to create numerous connections to arrive at a correct interpretation, requiring more brainpower than literal statements. Although it is often considered juvenile irreverence, sarcasm is actually evidence of maturity ‚Äì because it takes years for a child's developing brain to fully understand and master it.",
                text: "According to the text, sarcasm:",
                options: ["denotes a lack of respect for people and things", "requires a child's brain to be better understood", "is a sign of intelligence and of a maturing brain", "is evidence that a teenager's brain has not developed yet"],
                correct: 2,
                explanation: "Il testo dice che il sarcasmo 'is actually evidence of maturity' e richiede pi√π potenza cerebrale. √à un segno di intelligenza e di un cervello che matura, non di mancanza di rispetto o di sviluppo incompleto."
            },
            {
                type: "relative",
                text: "This is the most expensive mobile ______ they had in store. I only buy the best technology at this point.",
                options: ["then", "than", "thus", "that"],
                correct: 3,
                explanation: "'That' √® il pronome relativo corretto per introdurre una proposizione relativa restrittiva. 'Than' si usa per comparazioni, 'then' per sequenze temporali, 'thus' significa 'quindi'. La struttura √®: superlativo + that + clausola relativa."
            },
            {
                type: "tense",
                text: "When I travel to England next year, I ____________ English for 6 years, so I will be able to speak the language fluently.",
                options: ["will have studied", "study", "have studying", "studies"],
                correct: 0,
                explanation: "Il Future Perfect ('will have studied') indica un'azione che sar√† completata prima di un momento futuro. La struttura 'for 6 years' indica durata e richiede questo tempo. Si usa per esprimere un'esperienza completata prima di un punto futuro."
            },
            {
                type: "infinitive",
                text: "My new boss didn't let ____________ on holiday during the emergency at work.",
                options: ["me go", "to go", "me to go", "me going"],
                correct: 0,
                explanation: "Il verbo 'let' √® seguito dall'oggetto + infinito senza 'to' (bare infinitive). La struttura √®: let + oggetto + verbo base. Altri verbi come 'allow' richiederebbero 'to' (allow me to go), ma 'let' no."
            },
            {
                type: "phrasal",
                text: "You have to ____________ with this issue, so we can go on with the plan.",
                options: ["make", "beat", "solve", "deal"],
                correct: 3,
                explanation: "'Deal with' significa 'occuparsi di' o 'gestire' un problema. √à il phrasal verb corretto per problemi o questioni. 'Solve' si usa senza preposizione (solve the problem), mentre 'deal with' richiede 'with'."
            },
            {
                type: "gerund",
                text: "____________ the radio helps me improve my receptive skills.",
                options: ["Listen to", "Listening to", "Listened to", "Have listened to"],
                correct: 1,
                explanation: "Quando un verbo √® soggetto della frase, si usa il gerundio (-ing form). 'Listening to the radio' √® il soggetto della frase. Il gerundio rende il verbo un sostantivo e pu√≤ funzionare come soggetto, oggetto o complemento."
            },
            {
                type: "vocabulary",
                text: "Large cruise ships are usually run with a ____________ of at least 200 people.",
                options: ["crew", "cast", "squad", "gang"],
                correct: 0,
                explanation: "'Crew' √® il termine specifico per il personale di una nave. 'Cast' si usa per attori, 'squad' per squadre sportive o militari, 'gang' ha connotazione negativa (banda criminale). Ogni contesto ha il suo termine specifico."
            },
            {
                type: "vocabulary",
                text: "Have you ever been ____________ while travelling abroad?",
                options: ["shoplifted", "vandalised", "mugged", "stolen"],
                correct: 2,
                explanation: "'Mugged' significa essere rapinato per strada con violenza. 'Shoplifted' √® rubare nei negozi (non si usa con persone come soggetto passivo), 'vandalised' √® danneggiare propriet√†, 'stolen' non si usa in forma passiva con persone."
            },
            {
                type: "tense",
                text: "The old woman _______________ the burglar and scared him off.",
                options: ["shouted at", "will shout at", "whispered", "had whispered"],
                correct: 0,
                explanation: "Il Past Simple 'shouted at' √® corretto perch√© descrive due azioni passate in sequenza. 'Scared him off' (lo spavent√≤ via) √® anch'esso Past Simple, indicando che le due azioni sono avvenute nello stesso momento nel passato."
            },
            {
                type: "verb-pattern",
                text: "She doesn't ____________ looking after the baby for us next weekend, does she?",
                options: ["hope", "mind", "object", "stand"],
                correct: 1,
                explanation: "'Mind' + gerundio significa 'dispiacersi di fare qualcosa'. Si usa spesso in domande o frasi negative: 'Do you mind...?' / 'I don't mind...'. 'Object to' richiederebbe la preposizione 'to', 'hope' non si usa in questo pattern."
            },
            {
                type: "correlative",
                text: "Sarah could attend _________________ the morning meeting nor the afternoon session today.",
                options: ["neither", "both", "either", "nor"],
                correct: 0,
                explanation: "'Neither...nor' √® una struttura correlativa che significa 'n√©...n√©'. Si usa per negare entrambe le opzioni. 'Either...or' sarebbe per situazioni affermative. La struttura richiede 'neither' all'inizio quando si nega."
            },
            {
                type: "vocabulary",
                text: "I called him to ____________ him about the train strike.",
                options: ["warn", "say", "speak", "advertise"],
                correct: 0,
                explanation: "'Warn someone about something' significa avvisare qualcuno di un pericolo o problema. 'Say' e 'speak' non si usano con questa struttura (say something to someone / speak to someone about something). 'Advertise' significa fare pubblicit√†."
            },
            {
                type: "conditional",
                text: "If I ____________ more time, I would have finished the project yesterday.",
                options: ["have had", "had", "had had", "would have"],
                correct: 2,
                explanation: "Il Third Conditional (if + past perfect, would have + past participle) esprime situazioni ipotetiche nel passato. 'Had had' √® il Past Perfect di 'have', necessario per indicare che la condizione era nel passato prima di un altro evento passato."
            },
            {
                type: "preposition",
                text: "The company specializes ____________ renewable energy solutions.",
                options: ["on", "in", "at", "with"],
                correct: 1,
                explanation: "'Specialize in' √® la costruzione corretta. Molti verbi hanno preposizioni specifiche: depend on, succeed in, excel at. Queste collocazioni devono essere memorizzate perch√© non seguono sempre una logica prevedibile."
            },
            {
                type: "modal",
                text: "You ____________ have told me about the meeting! I missed it completely.",
                options: ["should", "must", "would", "can"],
                correct: 0,
                explanation: "'Should have + past participle' esprime un rimpianto o una critica per qualcosa che non √® stato fatto nel passato. √à diverso da 'must have' (deduzione forte) o 'would have' (condizionale passato)."
            },
            {
                type: "passive",
                text: "The new regulations ____________ by the government next month.",
                options: ["will implement", "will be implementing", "will be implemented", "are implementing"],
                correct: 2,
                explanation: "La forma passiva futura 'will be implemented' √® corretta perch√© le regolazioni 'vengono implementate' (azione subita dal soggetto). La struttura √®: will + be + past participle. Il passivo si usa quando il focus √® sull'azione, non su chi la compie."
            },
            {
                type: "reported-speech",
                text: "She told me that she ____________ to Paris the following week.",
                options: ["will go", "would go", "goes", "is going"],
                correct: 1,
                explanation: "Nel discorso indiretto, 'will' diventa 'would' quando il verbo principale √® al passato. Questo √® chiamato 'backshift' o concordanza dei tempi. 'The following week' √® l'equivalente di 'next week' nel discorso indiretto."
            },
            {
                type: "vocabulary",
                text: "The witness gave a very ____________ account of what happened that night.",
                options: ["detailed", "details", "detailing", "detail"],
                correct: 0,
                explanation: "'Detailed' √® l'aggettivo che significa 'dettagliato'. Gli aggettivi modificano i sostantivi ('detailed account'). 'Details' √® il sostantivo plurale, 'detailing' √® il gerundio, 'detail' √® il sostantivo singolare o verbo."
            },
            {
                type: "phrasal",
                text: "I can't ____________ with this noise anymore. I need to find a quieter place to work.",
                options: ["put up", "put on", "put off", "put down"],
                correct: 0,
                explanation: "'Put up with' significa 'tollerare' o 'sopportare'. Altri phrasal verbs: 'put on' (indossare), 'put off' (rimandare o disgustare), 'put down' (posare o criticare). I phrasal verbs spesso hanno significati non letterali."
            },
            {
                type: "article",
                text: "She plays ____________ piano beautifully, but she can't play ____________ guitar.",
                options: ["the / the", "a / a", "the / a", "‚Äî / the"],
                correct: 0,
                explanation: "Gli strumenti musicali richiedono l'articolo 'the' quando si parla di suonarli: 'play the piano', 'play the guitar'. √à un'eccezione alle regole generali degli articoli e deve essere memorizzata."
            },
            {
                type: "comparative",
                text: "The ____________ you practice, the ____________ you'll become at speaking English.",
                options: ["more / better", "most / best", "more / best", "much / good"],
                correct: 0,
                explanation: "'The more...the better' √® una struttura comparativa parallela che indica una correlazione proporzionale. Entrambe le parti usano la forma comparativa. La struttura √®: the + comparativo + subject + verb, the + comparativo + subject + verb."
            },
            {
                type: "vocabulary",
                text: "The professor's lecture was so ____________ that half the students fell asleep.",
                options: ["bored", "boring", "bore", "boredom"],
                correct: 1,
                explanation: "'Boring' (participio presente) descrive ci√≤ che causa noia. 'Bored' (participio passato) descrive chi prova noia. Regola generale: -ing per la causa, -ed per l'effetto (interesting/interested, exciting/excited)."
            },
            {
                type: "conjunction",
                text: "____________ it was raining heavily, we decided to go hiking.",
                options: ["Despite", "Although", "However", "In spite"],
                correct: 1,
                explanation: "'Although' √® una congiunzione seguita da soggetto + verbo. 'Despite' e 'in spite of' sono seguiti da sostantivo/gerundio. 'However' √® un avverbio che collega frasi, non clausole. La struttura determina la scelta."
            },
            {
                type: "wish",
                text: "I wish I ____________ more attention in my English classes when I was younger.",
                options: ["paid", "had paid", "would pay", "pay"],
                correct: 1,
                explanation: "'Wish + past perfect' esprime un rimpianto per il passato. Si usa per situazioni che non si possono cambiare. 'Wish + past simple' √® per il presente, 'wish + would' per situazioni future o comportamenti fastidiosi."
            },
            {
                type: "quantifier",
                text: "There is ____________ information available about this topic online.",
                options: ["many", "much", "few", "a few"],
                correct: 1,
                explanation: "'Much' si usa con sostantivi non numerabili ('information', 'water', 'money'). 'Many' √® per numerabili plurali ('books', 'people'). 'Few/a few' sono per numerabili plurali. La distinzione numerabile/non numerabile √® fondamentale."
            },
            {
                type: "causative",
                text: "I need to ____________ my laptop repaired before the presentation tomorrow.",
                options: ["make", "have", "let", "get"],
                correct: 3,
                explanation: "'Get something done' √® una struttura causativa che significa 'far fare qualcosa da qualcun altro'. 'Have something done' √® simile ma pi√π formale. 'Make' e 'let' non si usano in questa struttura passiva."
            },
            {
                type: "vocabulary",
                text: "The company's profits have ____________ by 30% compared to last year.",
                options: ["raised", "risen", "aroused", "arisen"],
                correct: 1,
                explanation: "'Rise' (intransitivo - risen al participio) significa 'aumentare' da solo. 'Raise' (transitivo) significa 'aumentare qualcosa' e richiede un oggetto. 'Arise' significa 'sorgere/emergere', 'arouse' significa 'suscitare/provocare'."
            },
            {
                type: "preposition",
                text: "The meeting has been put ____________ until next Friday due to the director's illness.",
                options: ["off", "on", "up", "down"],
                correct: 0,
                explanation: "'Put off' significa 'rimandare' o 'posticipare'. 'Put on' significa indossare o mettere in scena, 'put up' significa ospitare o costruire, 'put down' significa posare o criticare."
            },
            {
                type: "modal",
                text: "You ____________ be exhausted after working 12 hours straight!",
                options: ["should", "must", "might", "could"],
                correct: 1,
                explanation: "'Must' esprime una deduzione logica forte (certezza al 95%). 'Should' indica probabilit√† minore, 'might/could' indicano possibilit√†. Il contesto (12 ore di lavoro) richiede una deduzione forte."
            },
            {
                type: "relative",
                text: "The woman ____________ I met at the conference was a renowned scientist.",
                options: ["who", "whom", "which", "whose"],
                correct: 1,
                explanation: "'Whom' √® il pronome relativo oggetto per persone (formale). 'Who' √® soggetto, 'which' per cose, 'whose' per possesso. Qui 'I met' richiede un oggetto, quindi 'whom' (o informalmente 'who')."
            },
            {
                type: "conditional",
                text: "Unless you ____________ harder, you won't pass the exam.",
                options: ["will study", "study", "studied", "would study"],
                correct: 1,
                explanation: "'Unless' (a meno che) √® seguita dal Present Simple per azioni future, come 'if'. Non si usa mai 'will' dopo 'unless' o 'if' nelle frasi condizionali di tipo 1."
            },
            {
                type: "vocabulary",
                text: "The new policy has ____________ a lot of controversy among employees.",
                options: ["raised", "risen", "aroused", "arisen"],
                correct: 2,
                explanation: "'Arouse' (transitivo) significa 'suscitare' o 'provocare' sentimenti, reazioni. Si usa con: controversy, suspicion, interest, anger. 'Raise' √® pi√π neutrale, 'rise/arise' sono intransitivi."
            },
            {
                type: "gerund",
                text: "I regret ____________ you that your application has been unsuccessful.",
                options: ["informing", "to inform", "inform", "informed"],
                correct: 1,
                explanation: "'Regret to do' significa dispiacersi di dover fare qualcosa (presente/futuro). 'Regret doing' significa pentirsi di aver fatto qualcosa (passato). Qui si comunica una notizia ora, quindi 'to inform'."
            },
            {
                type: "phrasal",
                text: "The project fell ____________ when the main investor withdrew funding.",
                options: ["through", "down", "off", "over"],
                correct: 0,
                explanation: "'Fall through' significa 'fallire' o 'andare a monte' (per piani, accordi). 'Fall down' √® cadere fisicamente, 'fall off' diminuire o staccarsi, 'fall over' ribaltarsi."
            },
            {
                type: "vocabulary",
                text: "The government plans to ____________ new taxes on luxury goods next year.",
                options: ["impose", "compose", "expose", "dispose"],
                correct: 0,
                explanation: "'Impose' significa 'imporre' (tasse, regole, sanzioni). 'Compose' √® comporre/creare, 'expose' √® esporre/rivelare, 'dispose' √® disporre/liberarsi di. Collocazione: impose taxes/restrictions/penalties."
            },
            {
                type: "adjective",
                text: "The evidence presented in court was highly ____________ and led to a conviction.",
                options: ["credible", "credulous", "incredible", "credited"],
                correct: 0,
                explanation: "'Credible' significa 'credibile' o 'attendibile'. 'Credulous' significa 'credulone', 'incredible' significa 'incredibile/straordinario', 'credited' √® il participio di 'accreditare'."
            },
            {
                type: "preposition",
                text: "The success of the campaign was attributed ____________ the team's hard work.",
                options: ["to", "with", "for", "on"],
                correct: 0,
                explanation: "'Attribute something to something/someone' significa 'attribuire qualcosa a'. √à una collocazione fissa. Altre collocazioni con 'to': contribute to, lead to, amount to."
            },
            {
                type: "passive",
                text: "By the time you arrive, the documents ____________ and sent to the client.",
                options: ["will have been signed", "will sign", "will be signing", "have been signed"],
                correct: 0,
                explanation: "Future Perfect Passive 'will have been + past participle' indica un'azione passiva completata prima di un momento futuro. I documenti subiranno l'azione (firma) prima dell'arrivo."
            },
            {
                type: "vocabulary",
                text: "The company decided to ____________ operations in three European countries.",
                options: ["cease", "seize", "please", "tease"],
                correct: 0,
                explanation: "'Cease' significa 'cessare' o 'interrompere'. 'Seize' significa 'afferrare/sequestrare', 'please' significa 'piacere/accontentare', 'tease' significa 'prendere in giro'. Attenzione alla pronuncia simile."
            },
            {
                type: "inversion",
                text: "Rarely ____________ such dedication from employees.",
                options: ["have we seen", "we have seen", "we see", "did we saw"],
                correct: 0,
                explanation: "Dopo avverbi negativi/limitativi (rarely, seldom, never, hardly) si usa l'inversione soggetto-ausiliare. La struttura √®: avverbio + ausiliare + soggetto + verbo principale (rarely have we seen)."
            },
            {
                type: "phrasal",
                text: "The investigation ____________ that the company had been evading taxes for years.",
                options: ["brought out", "brought up", "brought about", "brought to light"],
                correct: 3,
                explanation: "'Bring to light' significa 'portare alla luce' o 'rivelare'. 'Bring out' √® pubblicare/far emergere, 'bring up' √® crescere/menzionare, 'bring about' √® causare."
            },
            {
                type: "subjunctive",
                text: "The board insists that all employees ____________ the new safety training.",
                options: ["attend", "attends", "attended", "will attend"],
                correct: 0,
                explanation: "Dopo verbi come 'insist', 'suggest', 'demand', 'recommend' si usa il congiuntivo (subjunctive): soggetto + verbo base (senza -s). √à una struttura formale tipica dell'inglese americano."
            },
            {
                type: "vocabulary",
                text: "The witness was asked to ____________ the sequence of events that night.",
                options: ["recollect", "collect", "elect", "select"],
                correct: 0,
                explanation: "'Recollect' significa 'ricordare' o 'rammentare'. 'Collect' √® raccogliere, 'elect' √® eleggere, 'select' √® selezionare. Il prefisso 're-' indica 'di nuovo' ‚Üí richiamare alla memoria."
            },
            {
                type: "reported-speech",
                text: "The manager said that the report ____________ by the end of the week.",
                options: ["must be completed", "had to be completed", "has to be completed", "must have completed"],
                correct: 1,
                explanation: "Nel discorso indiretto, 'must' diventa 'had to' quando il verbo principale √® al passato. La forma passiva 'be completed' rimane invariata. 'Must have + past participle' √® per deduzioni sul passato."
            },
            {
                type: "preposition",
                text: "The new regulations will come ____________ effect from January 1st.",
                options: ["into", "in", "to", "on"],
                correct: 0,
                explanation: "'Come into effect' √® una collocazione fissa che significa 'entrare in vigore' (per leggi, regolamenti). Altre collocazioni con 'into': get into trouble, look into something, run into someone."
            },
            {
                type: "vocabulary",
                text: "The company's reputation was severely ____________ by the scandal.",
                options: ["damaged", "injured", "wounded", "hurt"],
                correct: 0,
                explanation: "'Damage' si usa per oggetti, reputazioni, relazioni. 'Injure' √® per lesioni fisiche in incidenti, 'wound' per ferite da armi, 'hurt' per dolore fisico/emotivo generale. Ogni verbo ha un contesto specifico."
            },
            {
                type: "quantifier",
                text: "____________ students passed the exam, which was disappointing for the teachers.",
                options: ["Few", "A few", "Little", "A little"],
                correct: 0,
                explanation: "'Few' (pochi - negativo) vs 'a few' (alcuni - positivo) per numerabili. 'Little/a little' per non numerabili. 'Few' senza articolo ha connotazione negativa (quasi nessuno)."
            },
            {
                type: "phrasal",
                text: "I couldn't ____________ what she was saying because of the background noise.",
                options: ["make up", "make out", "make for", "make off"],
                correct: 1,
                explanation: "'Make out' significa 'riuscire a capire/distinguere' (con difficolt√†). 'Make up' √® inventare/truccarsi/riconciliarsi, 'make for' √® dirigersi verso, 'make off' √® scappare."
            },
            {
                type: "vocabulary",
                text: "The company provides ____________ training for all new employees.",
                options: ["comprehensive", "comprehensible", "comprehensive", "apprehensive"],
                correct: 0,
                explanation: "'Comprehensive' significa 'completo/esaustivo'. 'Comprehensible' significa 'comprensibile', 'apprehensive' significa 'apprensivo/preoccupato'. Attenzione alle parole simili con significati diversi."
            },
            {
                type: "conditional",
                text: "I would have helped you if you ____________ me you were struggling.",
                options: ["told", "had told", "would tell", "have told"],
                correct: 1,
                explanation: "Third Conditional: if + past perfect, would have + past participle. Esprime rimpianto per situazioni passate irreali. 'Had told' √® il Past Perfect necessario nella clausola condizionale."
            },
            {
                type: "emphasis",
                text: "It was the marketing team ____________ came up with the brilliant campaign idea.",
                options: ["who", "which", "what", "whom"],
                correct: 0,
                explanation: "La struttura enfatica 'It was...who/that' (cleft sentence) mette in risalto un elemento. Per persone si usa 'who' o 'that', per cose solo 'that'. Serve a dare enfasi a chi ha fatto l'azione."
            },
            {
                type: "vocabulary",
                text: "The board will ____________ a decision on the merger next month.",
                options: ["make", "do", "take", "have"],
                correct: 2,
                explanation: "'Take a decision' (UK) o 'make a decision' (US) sono entrambi corretti. In UK English 'take' √® pi√π comune per decisioni formali/importanti. 'Do/have a decision' non sono corretti."
            },
            {
                type: "preposition",
                text: "The increase in sales can be accounted ____________ the successful marketing campaign.",
                options: ["for by", "by for", "to by", "by to"],
                correct: 0,
                explanation: "'Account for' significa 'spiegare/giustificare'. Quando si usa la forma passiva, diventa 'be accounted for by'. Due preposizioni consecutive: 'for' appartiene al phrasal verb, 'by' introduce l'agente."
            },
            {
                type: "mixed-conditional",
                text: "If I had studied medicine, I ____________ a doctor now.",
                options: ["would be", "would have been", "will be", "had been"],
                correct: 0,
                explanation: "Mixed Conditional: if + past perfect (condizione passata), would + infinito (risultato presente). La condizione era nel passato ma il risultato √® ora. 'Would be' esprime lo stato attuale ipotetico."
            },
            {
                type: "vocabulary",
                text: "The research findings ____________ the hypothesis that had been proposed earlier.",
                options: ["confirmed", "conformed", "informed", "reformed"],
                correct: 0,
                explanation: "'Confirm' significa 'confermare'. 'Conform' significa 'conformarsi', 'inform' significa 'informare', 'reform' significa 'riformare'. Attenzione ai verbi simili con prefissi diversi."
            },
            {
                type: "phrasal",
                text: "The negotiations broke ____________ after both parties failed to reach an agreement.",
                options: ["down", "up", "off", "out"],
                correct: 0,
                explanation: "'Break down' significa 'fallire' (negoziazioni) o 'guastarsi' (macchine). 'Break up' √® separarsi/sciogliersi, 'break off' √® interrompere bruscamente, 'break out' √® scoppiare (guerra, incendio)."
            },
            {
                type: "advanced-grammar",
                text: "____________ the difficulties, the team managed to complete the project on time.",
                options: ["Despite of", "Despite", "Although", "Even"],
                correct: 1,
                explanation: "'Despite' + sostantivo/gerundio (senza 'of'). 'In spite of' richiede 'of'. 'Although' + soggetto + verbo. 'Even' da solo non introduce concessione. Common error: 'despite of' √® sempre sbagliato."
            },
            {
                type: "vocabulary",
                text: "The company is seeking to ____________ its presence in Asian markets.",
                options: ["expand", "expend", "extend", "extent"],
                correct: 0,
                explanation: "'Expand' significa 'espandere' (business, territorio). 'Expend' significa 'spendere' (energie, risorse), 'extend' significa 'estendere' (tempo, durata), 'extent' √® un sostantivo (misura, grado)."
            },
            {
                type: "causative",
                text: "The director had the entire team ____________ overtime to meet the deadline.",
                options: ["work", "to work", "working", "worked"],
                correct: 0,
                explanation: "'Have someone do something' (causativo attivo) usa l'infinito senza 'to'. Significa 'far fare qualcosa a qualcuno'. Diverso da 'have something done' (causativo passivo) che usa il participio passato."
            },
            {
                type: "preposition",
                text: "The success of the project hinges ____________ securing adequate funding.",
                options: ["on", "in", "at", "to"],
                correct: 0,
                explanation: "'Hinge on' significa 'dipendere da' o 'essere basato su'. √à una collocazione fissa usata per indicare un fattore critico. Simile a 'depend on' ma pi√π formale e enfatico."
            },
            {
                type: "vocabulary",
                text: "The defendant was ____________ of all charges due to lack of evidence.",
                options: ["acquitted", "convicted", "accused", "prosecuted"],
                correct: 0,
                explanation: "'Acquit' significa 'assolvere/prosciogliere'. 'Convict' √® condannare, 'accuse' √® accusare, 'prosecute' √® perseguire legalmente. Vocabolario legale: acquittal (assoluzione) vs conviction (condanna)."
            },
            {
                type: "inversion",
                text: "No sooner ____________ the announcement than the phones started ringing.",
                options: ["had we made", "we had made", "did we make", "we made"],
                correct: 0,
                explanation: "'No sooner...than' richiede inversione + Past Perfect. Significa 'non appena'. La struttura √®: No sooner + ausiliare + soggetto + past participle + than + past simple."
            },
            {
                type: "collocation",
                text: "The company decided to ____________ an inquiry into the allegations of misconduct.",
                options: ["conduct", "lead", "make", "do"],
                correct: 0,
                explanation: "'Conduct an inquiry/investigation' √® la collocazione corretta. 'Conduct' si usa con: research, survey, business, orchestra. 'Carry out' √® alternativa possibile. 'Make/do an inquiry' non sono standard."
            },
            {
                type: "vocabulary",
                text: "The economic downturn had a ____________ impact on small businesses.",
                options: ["devastated", "devastating", "devastate", "devastation"],
                correct: 1,
                explanation: "Il participio presente 'devastating' √® l'aggettivo che descrive qualcosa che causa devastazione. 'Devastated' descrive chi/cosa √® stato devastato. 'Devastate' √® il verbo, 'devastation' il sostantivo."
            },
            {
                type: "phrasal",
                text: "The committee will look ____________ the proposal before making a final decision.",
                options: ["into", "for", "after", "through"],
                correct: 0,
                explanation: "'Look into' significa 'esaminare' o 'investigare'. 'Look for' √® cercare, 'look after' √® prendersi cura di, 'look through' √® scorrere/esaminare rapidamente documenti."
            },
            {
                type: "participle",
                text: "____________ by the results, the researchers decided to conduct further experiments.",
                options: ["Encouraging", "Encouraged", "To encourage", "Encourage"],
                correct: 1,
                explanation: "Participio passato 'encouraged' perch√© i ricercatori ricevono l'incoraggiamento (sono incoraggiati). Participio presente si userebbe se fossero loro a incoraggiare. Participio passato = passivo, presente = attivo."
            },
            {
                type: "vocabulary",
                text: "The government announced plans to ____________ the minimum wage by 10%.",
                options: ["raise", "rise", "arise", "rouse"],
                correct: 0,
                explanation: "'Raise' (transitivo) + oggetto significa 'aumentare qualcosa'. 'Rise' √® intransitivo (aumentare da solo), 'arise' √® sorgere/emergere, 'rouse' √® svegliare/stimolare. Solo 'raise' richiede un oggetto diretto."
            },
            {
                type: "modal-perfect",
                text: "The client ____________ received our proposal by now; I sent it three days ago.",
                options: ["must have", "should have", "could have", "would have"],
                correct: 0,
                explanation: "'Must have + past participle' esprime deduzione forte sul passato (certezza logica). 'Should have' √® per azioni dovute non fatte, 'could have' per possibilit√† passate, 'would have' per condizionali."
            },
            {
                type: "preposition",
                text: "The new policy is aimed ____________ reducing carbon emissions by 50%.",
                options: ["at", "to", "for", "on"],
                correct: 0,
                explanation: "'Be aimed at + gerundio' significa 'mirare a' o 'avere come obiettivo'. √à una collocazione fissa. Altre strutture simili: be directed at, be targeted at, be designed to (+ infinito)."
            },
            {
                type: "vocabulary",
                text: "The report highlights several ____________ issues that need immediate attention.",
                options: ["pressing", "pressing", "stressed", "stressful"],
                correct: 0,
                explanation: "'Pressing' significa 'urgente' o 'pressante' (pressing issues/matters/concerns). 'Stressed' descrive persone sotto stress, 'stressful' descrive situazioni che causano stress. Contesto determina la scelta."
            },
            {
                type: "gerund-infinitive",
                text: "We stopped ____________ petrol before continuing our journey.",
                options: ["to get", "getting", "get", "got"],
                correct: 0,
                explanation: "'Stop to do' = fermarsi per fare qualcosa (scopo). 'Stop doing' = smettere di fare qualcosa. Qui si fermano CON LO SCOPO di prendere benzina. Differenza cruciale di significato."
            },
            {
                type: "collocation",
                text: "The company has ____________ significant progress in reducing its environmental impact.",
                options: ["made", "done", "taken", "had"],
                correct: 0,
                explanation: "'Make progress' √® la collocazione standard. Altri usi di 'make': make an effort, make a decision, make a mistake, make a difference. 'Do' si usa con: homework, business, research."
            },
            {
                type: "vocabulary",
                text: "The lawyer advised her client to ____________ the settlement offer.",
                options: ["accept", "except", "expect", "excerpt"],
                correct: 0,
                explanation: "'Accept' significa 'accettare'. 'Except' significa 'eccetto' (preposizione), 'expect' significa 'aspettarsi', 'excerpt' significa 'estratto'. Parole foneticamente simili ma significati completamente diversi."
            },
            {
                type: "phrasal",
                text: "The CEO stepped ____________ after 20 years of leading the company.",
                options: ["down", "up", "out", "in"],
                correct: 0,
                explanation: "'Step down' significa 'dimettersi' (da una posizione). 'Step up' √® aumentare/farsi avanti, 'step out' √® uscire, 'step in' √® intervenire. Phrasal verb comune nel contesto aziendale."
            },
            {
                type: "emphasis",
                text: "What really ____________ was the team's ability to work under pressure.",
                options: ["matters", "mattered", "mattering", "to matter"],
                correct: 1,
                explanation: "In questa cleft sentence (frase scissa), 'what' introduce la clausola enfatica e richiede il Past Simple 'mattered' per concordare con il contesto passato. 'What matters' √® presente, qui serve il passato."
            },
            {
                type: "vocabulary",
                text: "The company's new strategy proved to be highly ____________ in increasing market share.",
                options: ["effective", "affective", "efficient", "defective"],
                correct: 0,
                explanation: "'Effective' significa 'efficace' (produce risultati desiderati). 'Efficient' significa 'efficiente' (ottimizza risorse). 'Affective' riguarda le emozioni, 'defective' significa difettoso. Effective = funziona bene."
            }
        ];

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            const shuffled = shuffle(questions);
            
            shuffled.forEach((q, idx) => {
                const card = document.createElement('div');
                card.className = 'card question-card';
                
                let content = `
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Domanda ${idx + 1} <small class="float-end">${q.type}</small></h5>
                    </div>
                    <div class="card-body">
                `;
                
                if (q.passage) {
                    content += `<div class="reading-passage">${q.passage}</div>`;
                }
                
                content += `
                        <p class="lead">${q.text}</p>
                        <div class="options">
                `;
                
                q.options.forEach((opt, i) => {
                    content += `
                        <div class="option" onclick="checkAnswer(${idx}, ${i})">
                            <strong>${String.fromCharCode(65 + i)}.</strong> ${opt}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                        <div class="explanation" id="exp-${idx}">
                            <strong>üìö Spiegazione:</strong> ${q.explanation}
                        </div>
                    </div>
                `;
                
                card.innerHTML = content;
                container.appendChild(card);
            });
        }

        function checkAnswer(qIdx, optIdx) {
            const q = shuffle(questions)[qIdx];
            const options = document.querySelectorAll('.question-card')[qIdx].querySelectorAll('.option');
            const explanation = document.getElementById(`exp-${qIdx}`);
            
            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (i === q.correct) {
                    opt.classList.add('correct');
                }
            });
            
            if (optIdx !== q.correct) {
                options[optIdx].classList.add('incorrect');
            }
            
            explanation.style.display = 'block';
        }

        renderQuestions();
    </script>
</body>
</html>